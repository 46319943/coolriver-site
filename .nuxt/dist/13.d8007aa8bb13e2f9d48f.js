webpackJsonp([13],{qbNh:function(x,s){x.exports='\x3c!--TAG Promise;await;async /TAG--\x3e\n<h1 id="-await-vs-return-vs-return-await">&#x7FFB;&#x8BD1;: await vs return vs return await</h1>\n<p><img src="http://oxjqfafek.bkt.clouddn.com/blog/171219/IDBFa4iifk.jpg?imageslim" alt="mark"></p>\n<h3 id="-">&#x524D;&#x8A00;</h3>\n<p>&#x53D7;&#x591F;&#x4E86;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF0C;&#x53C8;&#x89C9;&#x5F97;Promise&#x7528;&#x8D77;&#x6765;&#x4E0D;&#x8FC7;&#x763E;&#xFF0C;&#x60F3;&#x7528;&#x4E00;&#x4E0B;&#x66F4;&#x52A0;&#x4F18;&#x96C5;&#x7684;async/await&#x5417;&#xFF1F;&#x5728;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x6709;&#x54EA;&#x4E9B;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x548C;&#x5751;&#x3002;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528;&#x4E86;async/await&#x7684;&#x540C;&#x5B66;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x6709;&#x6CA1;&#x6709;&#x9047;&#x5230;&#x8FC7;&#x7C7B;&#x4F3C;&#x7684;&#x5751;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x672C;&#x6587;&#x662F;&#x8BD1;&#x6587;&#xFF0C;&#x559C;&#x6B22;&#x770B;&#x82F1;&#x6587;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x53BB;&#x4E0B;&#x6587;&#x539F;&#x6587;&#x94FE;&#x63A5;&#x53BB;&#x770B;&#x3002;</p>\n<blockquote>\n<p>&#x539F;&#x6587;&#x94FE;&#x63A5;: <a href="https://jakearchibald.com/2017/await-vs-return-vs-return-await/">await vs return vs return await</a>  </p>\n</blockquote>\n<p>&#x6B63;&#x6587;&#x5F00;&#x59CB;&#x5206;&#x5272;&#x7EBF;</p>\n<p><hr>\n&#x6B63;&#x6587;&#x5F00;&#x59CB;!  </p>\n<p>&#x5F53;&#x6211;&#x4EEC;&#x5728;&#x5199;async&#x51FD;&#x6570;&#x65F6;&#xFF0C;&#x6709;&#x51E0;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x5199;&#x6CD5;: <code>await</code>, <code>return</code>, <code>return await</code>&#x3002;&#x8FD9;&#x51E0;&#x79CD;&#x5199;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x6548;&#x679C;&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x6B63;&#x786E;&#x7684;&#x5199;&#x6CD5;&#x5341;&#x5206;&#x91CD;&#x8981;&#x3002;  </p>\n<p>&#x6211;&#x4EBA;&#x5148;&#x4ECE;&#x4E00;&#x4E2A;async&#x51FD;&#x6570;&#x5F00;&#x59CB;:  </p>\n<pre class="hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waitAndMaybeReject</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-comment">// &#x7B49;&#x4E00;&#x79D2;&#x949F;</span>\n  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> setTimeout(r, <span class="hljs-number">1000</span>));\n  <span class="hljs-comment">// &#x968F;&#x673A;&#x4E00;&#x628A;</span>\n  <span class="hljs-keyword">const</span> isHeads = <span class="hljs-built_in">Boolean</span>(<span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random()));\n\n  <span class="hljs-keyword">if</span> (isHeads) <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;yay&apos;</span>;\n  <span class="hljs-keyword">throw</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;Boo!&apos;</span>);\n}\n</pre>\n<p>&#x4E0A;&#x9762;&#x7684;&#x51FD;&#x6570;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7B49;&#x5F85;&#x4E00;&#x79D2;&#x7684;promise&#xFF0C;&#x4E00;&#x79D2;&#x4E4B;&#x540E;&#xFF0C;&#x6709;50%&#x7684;&#x6982;&#x7387;&#x83B7;&#x5F97;fullfill&#xFF08;resolve&#xFF09;&#x503C;&quot;yay&quot;&#xFF0C;&#x53E6;&#x5916;50%&#x7684;&#x6982;&#x7387;reject&#x4E00;&#x4E2A;error&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C06;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF1A;  </p>\n<h3 id="-">&#x76F4;&#x63A5;&#x8C03;&#x7528;</h3>\n<pre class="hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">try</span> {\n    waitAndMaybeReject();\n  }\n  <span class="hljs-keyword">catch</span> (e) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;caught&apos;</span>;\n  }\n}\n</pre>\n<p>&#x5728;&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8C03;&#x7528; <code>foo</code> &#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;promise&#x603B;&#x662F;<strong>&#x7ACB;&#x5373;</strong>&#x83B7;&#x5F97;<strong>fullfill&#x503C;undefined</strong>, &#x4E0D;&#x4F1A;&#x6709;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x3002;<br>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5BF9; <code>waitAndMaybeReject()</code> &#x7684;&#x7ED3;&#x679C;&#x8FDB;&#x884C; await &#x6216;&#x8005; return&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E0D;&#x4F1A;&#x6709;&#x671F;&#x671B;&#x7684;async&#x6548;&#x679C;&#x3002;&#x8FD9;&#x79CD;&#x4EE3;&#x7801;&#x4E00;&#x822C;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x5199;&#x6CD5;&#x3002;</p>\n<h3 id="awaiting">Awaiting</h3>\n<pre class="hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">await</span> waitAndMaybeReject();\n  }\n  <span class="hljs-keyword">catch</span> (e) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;caught&apos;</span>;\n  }\n}\n</pre>\n<p>&#x5728;&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8C03;&#x7528; <code>foo</code> &#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;promise&#x603B;&#x662F;&#x4F1A;&#x7B49;&#x5F85;&#x4E00;&#x79D2;&#xFF0C;&#x63A5;&#x7740;&#xFF0C;&#x8981;&#x4E48;&#x83B7;&#x5F97;<strong>fullfill&#x503C;undefined</strong>&#xFF0C;&#x8981;&#x4E48;&#x83B7;&#x5F97;<strong>fullfill&#x503C; &quot;caught&quot;</strong>&#x3002;<br>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;await&#x4E86; <code>waitAndMaybeReject()</code> &#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;rejection&#x76F8;&#x5F53;&#x4E8E;throw&#x4E86;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;&#xFF0C;&#x7136;&#x540E;catch&#x5757;&#x5C31;&#x80FD;&#x6355;&#x83B7;&#x5230;&#x8FD9;&#x4E2A;&#x5F02;&#x5E38;&#x3002;&#x5F53; <code>waitAndMaybeReject()</code> &#x662F;&#x6B63;&#x5E38;&#x7684;fullfill&#x65F6;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x6CA1;&#x5BF9;fullfill&#x7684;&#x503C;&#x505A;&#x4EFB;&#x4F55;&#x5904;&#x7406;&#xFF0C;&#x6240;&#x4EE5; <code>foo</code> &#x51FD;&#x6570;&#x7684;fullfill&#x503C;&#x662F;undefined&#x3002;  </p>\n<h3 id="retruning">Retruning</h3>\n<pre class="hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">return</span> waitAndMaybeReject();\n  }\n  <span class="hljs-keyword">catch</span> (e) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;caught&apos;</span>;\n  }\n}\n</pre>\n<p>&#x5728;&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8C03;&#x7528; <code>foo</code> &#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;promise&#x603B;&#x662F;&#x4F1A;&#x7B49;&#x5F85;&#x4E00;&#x79D2;&#xFF0C;&#x63A5;&#x7740;&#xFF0C;&#x8981;&#x4E48;&#x83B7;&#x5F97;<strong>fullfill&#x503C; &quot;yay&quot;</strong>, &#x8981;&#x4E48;<strong>reject(Error(&apos;Boo!&apos;))</strong>&#x3002;<br>&#x901A;&#x8FC7;&#x8FD4;&#x56DE; <code>waitAndMaybeReject()</code> &#x7684;&#x503C;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4F20;&#x9012;&#x4E86;&#x5B83;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF08;Promise&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;catch&#x5757;&#x91CC;&#x7684;&#x4EE3;&#x7801;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x3002;</p>\n<h3 id="return-awaiting">Return-awaiting</h3>\n<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5728;catch&#x5757;&#x4E2D;&#x6355;&#x83B7;&#x5230; <code>waitAndMaybeReject()</code> &#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5728;try&#x4E2D;&#x6B63;&#x5E38;&#x8FD4;&#x56DE; <code>waitAndMaybeReject()</code> &#x7684;fullfill&#x503C;&#xFF0C;&#x4F60;&#x5F97;&#x4F7F;&#x7528; <code>return await</code>:  </p>\n<pre class="hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> waitAndMaybeReject();\n  }\n  <span class="hljs-keyword">catch</span> (e) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;caught&apos;</span>;\n  }\n}\n</pre>\n<p>&#x5728;&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8C03;&#x7528; <code>foo</code> &#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;promise&#x603B;&#x662F;&#x4F1A;&#x7B49;&#x5F85;&#x4E00;&#x79D2;&#xFF0C;&#x63A5;&#x7740;&#xFF0C;&#x8981;&#x4E48;&#x83B7;&#x5F97;<strong>fullfill&#x503C; &quot;yay&quot;</strong>&#xFF0C;&#x8981;&#x4E48;&#x83B7;&#x5F97;<strong>fullfill&#x503C; &quot;caught&quot;</strong>&#x3002;<br>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;await&#x4E86; <code>waitAndMaybeReject()</code> &#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;rejection&#x76F8;&#x5F53;&#x4E8E;throw&#x4E86;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;&#xFF0C;&#x6211;&#x4EEC;&#x7684;catch&#x5757;&#x5C31;&#x4F1A;&#x6267;&#x884C;&#x3002;&#x5982;&#x679C; <code>waitAndMaybeReject()</code> &#x83B7;&#x5F97;&#x4E86;fullfill&#x503C;&#xFF08;&quot;yay&quot;&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5C06;&#x8FD9;&#x4E2A;&#x503C;&#x8FD4;&#x56DE;&#x3002;  </p>\n<p>&#x5982;&#x679C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x770B;&#x8D77;&#x6765;&#x4EE4;&#x4EBA;&#x8D39;&#x89E3;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x4EE3;&#x7801;&#x62C6;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x90E8;&#x5206;&#x6765;&#x770B;&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x8F83;&#x597D;&#x7406;&#x89E3;&#xFF1A;  </p>\n<pre class="hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">try</span> {\n    <span class="hljs-comment">// &#x7B49;&#x5F85; waitAndMaybeReject() &#x7684;&#x7ED3;&#x679C;&#x6765;&#x89E3;&#x51B3;,</span>\n    <span class="hljs-comment">// &#x5E76;&#x4E14;&#x5C06; fullfill &#x7684;&#x503C;&#x8D4B;&#x7ED9; fullfilledValue:</span>\n    <span class="hljs-keyword">const</span> fulfilledValue = <span class="hljs-keyword">await</span> waitAndMaybeReject();\n    <span class="hljs-comment">// &#x5982;&#x679C; waitAndMaybeReject() reject&#x4E86;&#xFF0C;</span>\n    <span class="hljs-comment">// &#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x5E76;&#x4E14;&#x8FDB;&#x5165; catch &#x4EE3;&#x7801;&#x5757;&#x7684;&#x903B;&#x8F91;&#x3002;</span>\n    <span class="hljs-comment">// &#x5426;&#x5219;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x4F1A;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x8BED;&#x53E5;:</span>\n    <span class="hljs-keyword">return</span> fulfilledValue;\n  }\n  <span class="hljs-keyword">catch</span> (e) {\n    <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;caught&apos;</span>;\n  }\n}\n</pre>\n<blockquote>\n<p>&#x6CE8;&#x610F;&#xFF1A;&#x5728; try/catch &#x5757;&#x4E4B;&#x5916;&#x6267;&#x884C; <code>return await</code> &#x662F;&#x591A;&#x4F59;&#x7684;&#x64CD;&#x4F5C;&#xFF08;&#x76F4;&#x63A5; <code>return</code> &#x5C31;&#x597D;&#x5566;&#xFF09;&#x3002;&#x751A;&#x81F3;Eslint&#x8FD8;<a href="https://github.com/eslint/eslint/blob/master/docs/rules/no-return-await.md">&#x4E13;&#x95E8;&#x6709;&#x89C4;&#x5219;&#x6765;&#x68C0;&#x6D4B;&#x8FD9;&#x79CD;&#x573A;&#x666F;</a>&#xFF0C;&#x5982;&#x679C;&#x5728; try/catch &#x5757;&#x4E4B;&#x5185;&#xFF0C;Eslint&#x5C31;&#x5141;&#x8BB8;&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#x3002;&#xFF08;&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x52A0;eslint disable&#x6765;&#x65E0;&#x89C6;&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#x9650;&#x5236;&#xFF09;<br><img src="http://oxjqfafek.bkt.clouddn.com/blog/171219/mIILl8aLAH.jpg?imageslim" alt="mark"></p>\n</blockquote>\n'}});
//# sourceMappingURL=13.d8007aa8bb13e2f9d48f.js.map