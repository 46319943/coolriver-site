{"version":3,"sources":["webpack:///webpack/bootstrap bfddaa5be5bd3327a75d","webpack:///external \"path\"","webpack:///./server/db/index.js","webpack:///external \"fs\"","webpack:///./server/models/index.js","webpack:///./server/db/libs/init.js","webpack:///external \"lowdb\"","webpack:///external \"lowdb/adapters/FileSync\"","webpack:///./server/models/article.js","webpack:///external \"shortid\"","webpack:///./config/site.js","webpack:///./server/server.js","webpack:///external \"koa\"","webpack:///external \"koa-sslify\"","webpack:///external \"http\"","webpack:///external \"https\"","webpack:///external \"nuxt\"","webpack:///./server/router/router.js","webpack:///external \"koa-router\"","webpack:///./server/controllers/article.js","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"regenerator-runtime\"","webpack:///./server/libs/cors.js","webpack:///external \"koa2-cors\"","webpack:///./nuxt.config.js"],"names":["low","require","FileSync","path","dbDataPath","resolve","__dirname","adapter","DB","defaults","posts","users","write","articleModel","get","insertOrUpdate","title","time","img","desc","tags","name","data","articleFind","find","value","push","Object","assign","id","shortid","generate","getList","filter","module","exports","dev","host","port","prod","app","config","env","siteConf","console","log","use","enforceHttps","nuxt","builder","build","catch","error","e","process","exit","setupCors","setupRouter","ctx","status","Promise","reject","res","on","render","req","promise","then","http","createServer","callback","listen","https","key","fs","readFileSync","cert","router","routes","next","query","limit","Number","MAX_SAFE_INTEGER","offset","tag","parseInt","list","sort","a","b","slice","item","indexOf","body","article","articles","map","reduce","result","cur","concat","tagsUniq","Array","from","Set","getTags","whiteDomain","cors","origin","hostname","ssrHost","head","meta","charset","content","hid","itemprop","link","rel","type","href","script","src","async","extend","imageLoaderConf","rules","test","toString","vueLoader","rule","loader","options","loaders","sass","search","replace","css","plugins","ssr","vendor"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap bfddaa5be5bd3327a75d","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 0\n// module chunks = 0 1 2","import DB from './libs/init';\n\nexport { DB };\n\n\n\n// WEBPACK FOOTER //\n// ./server/db/index.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 2\n// module chunks = 0 1 2","import  * as articleModel from './article';\n\nexport { articleModel };\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","const low = require('lowdb');\r\nconst FileSync = require('lowdb/adapters/FileSync');\r\nconst path = require('path');\r\nconst dbDataPath = path.resolve(__dirname, '../data.json');\r\nconst adapter = new FileSync(dbDataPath);\r\nconst DB = low(adapter);\r\n\r\n// Set some defaults\r\nDB.defaults({ posts: [], users: [] })\r\n  .write();\r\n\r\nexport default DB;\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/db/libs/init.js","module.exports = require(\"lowdb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lowdb\"\n// module id = 5\n// module chunks = 0 1 2","module.exports = require(\"lowdb/adapters/FileSync\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lowdb/adapters/FileSync\"\n// module id = 6\n// module chunks = 0 1 2","import { DB } from '../db/index';\nimport shortid from 'shortid';\n\nconst articleModel = DB.get('articles');\n\n// 添加或者更新（如果文章name已经存在的话）一个文章信息\nexport function insertOrUpdate({ title, time, img, desc, tags, name }) {\n  const data = {\n    title,\n    img,\n    desc,\n    tags,\n    name\n  };\n  const articleFind = find({ name });\n\n  if (!articleFind.value()) {\n    // 新增article时，需要传入id和创建时间\n    articleModel.push(Object.assign({}, data, {\n      id: shortid.generate(),\n      time: +time,\n    })).write();\n  } else {\n    articleFind.assign(data).write();\n  }\n};\n\n// 根据条件返回文章列表\nexport function getList (filter = {}) {\n  return articleModel.filter(filter);\n};\n\n// 根据条件返回一个文章信息\nexport function find (filter = {}) {\n  return articleModel.find(filter);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/article.js","module.exports = require(\"shortid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"shortid\"\n// module id = 8\n// module chunks = 0 1 2","module.exports = {\n  dev: {\n    host: '127.0.0.1',\n    port: 8880\n  },\n  prod: {\n    host: '127.0.0.1',\n    port: 80\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./config/site.js","\nimport Koa from 'koa';\nimport enforceHttps from'koa-sslify';\nimport http from 'http';\nimport https from 'https';\nimport path from 'path';\nimport fs from 'fs';\nimport { Nuxt, Builder } from 'nuxt';\nimport { DB } from './db/index';\nimport setupRouter from './router/router';\nimport setupCors from './libs/cors';\nimport siteConf from '../config/site';\n\nconst app = new Koa();\n// Import and Set Nuxt.js options\nlet config = require('../nuxt.config.js');\nconfig.dev = !(app.env === 'production');\n\nconst host = config.dev ? siteConf.dev.host : siteConf.prod.host;\nlet port = config.dev ? siteConf.dev.port : siteConf.prod.port;\n\n// 正式环境下启用https\nif (!config.dev) {\n  console.log('enable https');\n  app.use(enforceHttps());\n  // port = 80;\n}\n\n// Instantiate nuxt.js\nconst nuxt = new Nuxt(config);\n\n// Build in development\nif (config.dev) {\n  const builder = new Builder(nuxt);\n  builder.build().catch(e => {\n    console.error(e); // eslint-disable-line no-console\n    process.exit(1);\n  });\n}\n\nsetupCors(app);\nsetupRouter(app);\n\napp.use(ctx => {\n  ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n\n  return new Promise((resolve, reject) => {\n    ctx.res.on('close', resolve)\n    ctx.res.on('finish', resolve)\n    nuxt.render(ctx.req, ctx.res, promise => {\n      // nuxt.render passes a rejected promise into callback on error.\n      promise.then(resolve).catch(reject)\n    })\n  })\n})\n\n// app.listen(port, '0.0.0.0');\nhttp.createServer(app.callback()).listen(port);\n\nif (!config.dev) {\n  https.createServer({\n    key: fs.readFileSync(path.resolve(__dirname, './ssl/2_coolriver.net.cn.key')),\n    cert: fs.readFileSync(path.resolve(__dirname, './ssl/1_coolriver.net.cn_bundle.crt')),\n  }, app.callback()).listen(443);\n}\n\nconsole.log('Server listening on a ' + host + ':' + port); // eslint-disable-line no-console\n\n\n\n// WEBPACK FOOTER //\n// ./server/server.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 11\n// module chunks = 0 1","module.exports = require(\"koa-sslify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-sslify\"\n// module id = 12\n// module chunks = 0 1","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 13\n// module chunks = 0 1","module.exports = require(\"https\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"https\"\n// module id = 14\n// module chunks = 0 1","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 15\n// module chunks = 0 1","import Router from 'koa-router';\nimport * as article from '../controllers/article';\n\nconst router = new Router();\n\nexport default function setupRouter (app) {\n  router.get('/api/articles', article.getList);\n  router.get('/api/article', article.find);\n  router.get('/api/tags', article.getTags);\n\n  app.use(router.routes());\n};\n\n\n\n// WEBPACK FOOTER //\n// ./server/router/router.js","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 17\n// module chunks = 0 1","import { articleModel } from '../models/index';\n\nexport async function getList(ctx, next) {\n  let { limit = Number.MAX_SAFE_INTEGER, offset = 0, tag } = ctx.query;\n  limit = parseInt(limit, 10);\n  offset = parseInt(offset, 10);\n\n  let list = articleModel.getList()\n    .sort((a, b) => { // 按照最新的放在最前面排序\n      return a.time > b.time ? -1 : 1;\n    })\n    .slice(offset, limit + offset)\n    .value();\n\n  // 有标签筛选条件\n  if (tag) {\n    list = list.filter(item => item.tags.indexOf(tag) >= 0);\n  }\n\n  ctx.status = 200;\n  ctx.body = list;\n}\n\nexport async function find(ctx, next) {\n  const article = articleModel.find({ name: ctx.query.name }).value();\n  ctx.status = 200;\n  ctx.body = article;\n}\n\nexport async function getTags (ctx, next) {\n  const articles = articleModel.getList().value();\n  const tags = articles.map(article => article.tags)\n    .reduce((result, cur) => result.concat(cur), []);\n  const tagsUniq = Array.from(new Set(tags));\n\n  ctx.status = 200;\n  ctx.body = tagsUniq;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/article.js","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 19\n// module chunks = 0 1","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 20\n// module chunks = 0 1","import cors from 'koa2-cors';\n\nconst whiteDomain = [\n  'coolriver.net.cn',\n  'localhost',\n  '127.0.0.1',\n];\n\nexport default function setupCors (app) {\n  app.use(cors({\n    origin: (ctx) => {\n      // return '*';\n      // console.log(ctx.hostname);\n      if (whiteDomain.indexOf(ctx.hostname) >= 0) {\n        return ctx.origin;\n      }\n\n      return false;\n    },\n  }));\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/libs/cors.js","module.exports = require(\"koa2-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa2-cors\"\n// module id = 22\n// module chunks = 0 1","var siteConf = require('./config/site');\n\nvar ssrHost = process.env.NODE_ENV === 'production' ?\n  `http://${siteConf.prod.host}:${siteConf.prod.port}` :\n  `http://${siteConf.dev.host}:${siteConf.dev.port}`;\n\nconsole.log(ssrHost);\n\nmodule.exports = {\n  head: {\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'coolriver的个人博客站点' },\n      { hid: 'keywords', name: 'keywords', content: 'coolriver,前端,博客' },\n      { hid: 'shareimg', itemprop: 'image', content: 'https://coolriver.net.cn/avatar.jpg' },\n    ],\n    link: [\n      {\n        rel: 'icon',\n        type: 'image/x-icon',\n        href: '/favicon.ico',\n      },\n    ],\n    script: [\n      {\n        src: 'https://hm.baidu.com/hm.js?406ea27bfbb3000b689c8ab5f17ebb86',\n        async: 'async'\n      }\n    ],\n    title: 'coolriver的空间',\n  },\n  build: {\n    extend: function (config) {\n      const imageLoaderConf = config.module.rules.find(function (item) {\n        return item.test.toString().indexOf('|svg') >= 0;\n      });\n\n      const vueLoader = config.module.rules.find((rule) => rule.loader === 'vue-loader');\n      vueLoader.options.loaders.sass = 'vue-style-loader!css-loader!sass-loader';\n\n      imageLoaderConf.test = /\\.(png|jpe?g|gif)$/;\n\n      config.module.rules = [\n        {\n          test: /\\.md$/,\n          loaders: ['raw-loader', 'markdown-code-highlight-loader']\n        },\n        {\n          test: /\\.svg$/,\n          loader: 'svg-url-loader',\n          options: {\n            limit: 1000\n          }\n        },\n        {\n          test: /api-config\\.js$/,\n          loader: 'string-replace-loader',\n          query: {\n            search: '__HOST_PLACE_HOLDER__',\n            replace: ssrHost,\n          }\n        }\n      ].concat(config.module.rules);\n    }\n  },\n  css: [\n    'vuetify/dist/vuetify.css',\n    '~assets/css/common.css',\n    'mdi/css/materialdesignicons.css',\n    'highlight.js/styles/atom-one-dark.css',\n    'github-markdown-css/github-markdown.css'\n  ],\n  plugins: [\n    '~plugins/vue-vuetify',\n    {\n      src: '~plugins/busuanzi',\n      ssr: false\n    },\n    {\n      src: '~plugins/baidutongji',\n      ssr: false\n    },\n    '~plugins/filter',\n  ],\n  vendor: ['axios']\n};\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js"],"sourceRoot":""}